<!DOCTYPE html>
<html>
<head>
  <title>Clinic management</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  
  <%= javascript_importmap_tags %>
  <%#= stimulus_include_tags %>
  
  <%= stylesheet_link_tag "clinic_management/application", media: "all", "data-turbo-track": "reload" %>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <%= stylesheet_link_tag "clinic_management/table", "data-turbo-track": "application" %>
  <%= stylesheet_link_tag "clinic_management/table", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "clinic_management/main", "data-turbo-track": "reload" %>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- Move custom styles here to ensure they are loaded before the body renders -->
  <style>
    /* Prevenir zoom em todos os elementos */
    * {
      touch-action: pan-x pan-y !important;
      -ms-touch-action: pan-x pan-y !important;
    }
    
    html, body {
      touch-action: pan-x pan-y !important;
      -ms-touch-action: pan-x pan-y !important;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
    }
    
    button, a {
      touch-action: manipulation !important;
      -ms-touch-action: manipulation !important;
    }
    
    @media (min-width: 768px) {
      #main-container {
        margin-left: 280px;
      }
    }

    @media (max-width: 768px) {
      #main-container {
        display: flex;
      }
    }
  </style>
  
  <!-- Script para prevenir zoom no mobile -->
  <script>
    (function() {
      'use strict';
      
      // Prevenir zoom por pinch (dois dedos) - funciona em Android e iOS
      document.addEventListener('touchmove', function(event) {
        if (event.touches && event.touches.length > 1) {
          event.preventDefault();
        }
      }, { passive: false });

      // Prevenir zoom por gestos (iOS Safari apenas)
      document.addEventListener('gesturestart', function(event) {
        event.preventDefault();
      }, { passive: false });

      document.addEventListener('gesturechange', function(event) {
        event.preventDefault();
      }, { passive: false });

      document.addEventListener('gestureend', function(event) {
        event.preventDefault();
      }, { passive: false });

      // Aplicar CSS touch-action para prevenir zoom
      document.addEventListener('DOMContentLoaded', function() {
        document.body.style.touchAction = 'pan-x pan-y';
        document.documentElement.style.touchAction = 'pan-x pan-y';
      });
    })();
  </script>

  <!-- Global Loading Script - Shows loader after 2s delay, fallback UI after 5s -->
  <script>
    (function() {
      'use strict';

      /**
       * Timing Configuration
       * - DELAY: Time before showing loading overlay (2 seconds)
       * - FALLBACK_DELAY: Time before showing escape options (5 seconds)
       */
      var DELAY = 2000;
      var FALLBACK_DELAY = 5000;

      var timeout = null;
      var fallbackTimeout = null;
      var overlay = null;
      var fallback = null;

      function getOverlay() {
        if (!overlay) overlay = document.getElementById('global-loading-overlay');
        return overlay;
      }

      function getFallback() {
        if (!fallback) fallback = document.getElementById('global-loading-fallback');
        return fallback;
      }

      /**
       * Shows the loading overlay and starts fallback timer
       */
      function show() {
        var el = getOverlay();
        if (el) {
          el.classList.remove('opacity-0', 'invisible', 'pointer-events-none');
          el.classList.add('opacity-100', 'visible', 'pointer-events-auto');
          el.setAttribute('aria-hidden', 'false');

          // Start fallback timer after overlay is visible
          startFallbackTimer();
        }
      }

      /**
       * Shows the fallback UI with escape options
       */
      function showFallback() {
        var fb = getFallback();
        if (fb) {
          fb.classList.add('global-loading-fallback--visible');
          fb.setAttribute('aria-hidden', 'false');
        }
      }

      /**
       * Hides the fallback UI
       */
      function hideFallback() {
        var fb = getFallback();
        if (fb) {
          fb.classList.remove('global-loading-fallback--visible');
          fb.setAttribute('aria-hidden', 'true');
        }
      }

      /**
       * Hides everything and clears all timers
       */
      function hide() {
        clearAllTimers();
        hideFallback();

        var el = getOverlay();
        if (el) {
          el.classList.add('opacity-0', 'invisible', 'pointer-events-none');
          el.classList.remove('opacity-100', 'visible', 'pointer-events-auto');
          el.setAttribute('aria-hidden', 'true');
        }
      }

      /**
       * Starts the initial loading timer (2s)
       */
      function startTimer() {
        if (timeout) return;
        timeout = setTimeout(show, DELAY);
      }

      /**
       * Starts the fallback timer (5s from when loading appears)
       */
      function startFallbackTimer() {
        if (fallbackTimeout) return;
        fallbackTimeout = setTimeout(showFallback, FALLBACK_DELAY);
      }

      /**
       * Clears all timers
       */
      function clearAllTimers() {
        if (timeout) { clearTimeout(timeout); timeout = null; }
        if (fallbackTimeout) { clearTimeout(fallbackTimeout); fallbackTimeout = null; }
      }

      // Turbo Drive events
      document.addEventListener('turbo:before-fetch-request', startTimer);
      document.addEventListener('turbo:before-fetch-response', hide);
      document.addEventListener('turbo:visit', startTimer);
      document.addEventListener('turbo:load', hide);
      document.addEventListener('turbo:submit-start', startTimer);
      document.addEventListener('turbo:submit-end', hide);

      // Browser reload (F5, Ctrl+R)
      window.addEventListener('beforeunload', startTimer);

      // Keyboard support: Escape key to go back
      document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
          var el = getOverlay();
          if (el && !el.classList.contains('invisible')) {
            globalLoadingGoBack();
          }
        }
      });

      /**
       * Global fallback action handlers
       * Exposed to window for onclick handlers in the HTML
       */
      window.globalLoadingGoBack = function() {
        hide();
        window.history.back();
      };

      window.globalLoadingReload = function() {
        hide();
        window.location.reload();
      };

      window.globalLoadingGoHome = function() {
        hide();
        window.location.href = '/';
      };
    })();
  </script>
</head>
<body class="bg-gray-100 font-sans leading-normal tracking-normal" style="margin-bottom: 200px">
  <%# Global loading overlay - shows when requests take > 2 seconds %>
  <%= render "clinic_management/shared/global_loading" %>

  <%= render "clinic_management/shared/navbar" %>
  <%= render "clinic_management/shared/scroll_buttons" %>
  <%= content_for?(:breadcrumb) ? yield(:breadcrumb) : '' %>
  <br>
  <br>
  <br>
  <main class="my-8" id="main-container">
    <div class="container mx-auto">
      <%= yield %>
    </div>
  </main>

  <footer class="bg-gradient-to-r from-emerald-900 via-emerald-800 to-emerald-900 py-4 mt-16 fixed bottom-0 inset-x-0 shadow-md" style="z-index: 2000">
    <div class="container mx-auto text-center">
      <p class="text-white text-base font-medium">
        &copy; <%= Time.now.year %> - <%= yield(:footer) || "Nome da sua empresa" %>
      </p>
    </div>
  </footer>
</body>
</html>