<%# Subscrever ao canal de eventos da fila de ligações %>
<%= turbo_stream_from "call_queue_events" %>

<%# Dropdown flutuante da fila de ligações - aparece no canto inferior direito %>
<div data-call-queue-target="dropdown"
     class="call-queue-dropdown hidden"
     style="z-index: 100000 !important; position: fixed; bottom: 20px; right: 20px; width: 480px; max-height: 700px; z-index: 1000; background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); overflow: hidden;">
  
  <%# Header do Dropdown %>
  <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 py-3 flex items-center justify-between cursor-pointer"
       data-action="click->call-queue#toggleDropdown">
    <div class="flex items-center gap-2">
      <i class="fas fa-phone-volume"></i>
      <span class="font-semibold">Fila de Ligações</span>
      <span data-call-queue-target="counter" 
            class="bg-white text-blue-700 rounded-full px-2 py-0.5 text-xs font-bold">
        0
      </span>
    </div>
    <button type="button" class="text-white hover:text-gray-200">
      <i class="fas fa-chevron-down"></i>
    </button>
  </div>
  
  <%# Body do Dropdown %>
  <div class="call-queue-body" style="max-height: 500px; overflow-y: auto;">
    <%# Estado vazio %>
    <div data-call-queue-target="emptyState" class="text-center py-8 text-gray-500">
      <i class="fas fa-phone-slash text-4xl mb-3 text-gray-300"></i>
      <p class="text-sm">Nenhum lead na fila</p>
      <p class="text-xs mt-1">Clique em "Fila" para adicionar</p>
    </div>
    
    <%# Lista de leads na fila %>
    <div data-call-queue-target="queueList" class="divide-y divide-gray-200">
      <%# Preenchido dinamicamente via JavaScript %>
    </div>
  </div>
  
  <%# Footer com controles %>
  <div class="border-t border-gray-200 bg-gray-50 px-4 py-3">
    <div class="flex gap-2">
      <%# Botão Iniciar Sequência %>
      <button type="button"
              data-call-queue-target="startButton"
              data-action="click->call-queue#startSequence"
              class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded transition disabled:opacity-50 disabled:cursor-not-allowed text-sm">
        <i class="fas fa-play mr-1"></i>
        Iniciar Sequência
      </button>
      
      <%# Botão Pausar/Retomar %>
      <button type="button"
              data-call-queue-target="pauseButton"
              data-action="click->call-queue#pauseSequence"
              class="hidden bg-orange-600 hover:bg-orange-700 text-white font-semibold py-2 px-4 rounded transition text-sm">
        ⏸️ Pausar
      </button>
      
      <%# Botão Limpar Fila %>
      <button type="button"
              data-call-queue-target="clearButton"
              data-action="click->call-queue#clearQueue"
              class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-3 rounded transition text-sm"
              title="Limpar fila">
        <i class="fas fa-trash"></i>
      </button>
    </div>
  </div>
</div>

<style>
  .call-queue-dropdown {
    transition: all 0.3s ease-in-out;
  }
  
  .call-queue-dropdown.minimized {
    max-height: 60px;
  }
  
  .call-queue-dropdown.minimized .call-queue-body,
  .call-queue-dropdown.minimized .border-t {
    display: none;
  }
  
  .queue-item {
    transition: all 0.2s ease;
  }
  
  .queue-item.current {
    background: linear-gradient(90deg, #EFF6FF 0%, #DBEAFE 100%);
    animation: pulse 2s ease-in-out infinite;
  }
  
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; }
  }
  
  /* Seta indicadora de chamada ativa */
  .calling-indicator {
    color: #2563eb;
    font-size: 1.2rem;
    font-weight: bold;
    animation: bounce 1s ease-in-out infinite;
    display: inline-block;
  }
  
  @keyframes bounce {
    0%, 100% { transform: translateX(0); }
    50% { transform: translateX(5px); }
  }
  
  @keyframes slideInRight {
    from {
      transform: translateX(400px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  @keyframes slideOutRight {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(400px);
      opacity: 0;
    }
  }
  
  /* Scrollbar customizada para a lista */
  .call-queue-body::-webkit-scrollbar {
    width: 8px;
  }
  
  .call-queue-body::-webkit-scrollbar-track {
    background: #f1f1f1;
  }
  
  .call-queue-body::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 4px;
  }
  
  .call-queue-body::-webkit-scrollbar-thumb:hover {
    background: #555;
  }
</style>

