<div class="my-8">
  <% if @current_referral %>
    <h5 class="text-2xl font-bold">Minhas Mensagens Customizadas</h5>
    <p class="text-sm text-gray-600">Estas são as mensagens customizadas criadas por você.</p>
  <% else %>
    <h5 class="text-2xl font-bold">Mensagens Customizadas</h5>
  <% end %>
</div>

<% unless @current_referral %>
  <%# Tabs para usuários não-referral %>
  <div class="mb-6">
    <div class="border-b border-gray-200">
      <nav class="-mb-px flex space-x-4">
        <button onclick="showTab('personalizadas')" 
                id="tab-personalizadas"
                class="tab-button py-2 px-4 border-b-2 font-medium text-sm active">
          Personalizadas
        </button>
        <button onclick="showTab('globais')" 
                id="tab-globais"
                class="tab-button py-2 px-4 border-b-2 font-medium text-sm">
          Mensagens Globais
        </button>
      </nav>
    </div>
  </div>
<% end %>

<% if @current_referral %>
  <%# REFERRALS: Mostrar todas as mensagens sem tabs %>
  <%= render partial: 'messages_table', locals: { messages_to_show: @messages, show_type_column: false } %>
<% else %>
  <%# NÃO-REFERRALS: Separar em duas tabs %>
  
  <%# TAB: Mensagens Personalizadas %>
  <div id="tab-content-personalizadas" class="tab-content">
    <p class="text-sm text-gray-600 mb-4">Mensagens personalizadas que você criou. Você pode editar e excluir estas mensagens.</p>
    <% personalizadas = @messages.select { |m| m.message_type == 'outro' } %>
    <%= render partial: 'messages_table', locals: { messages_to_show: personalizadas, show_type_column: false } %>
  </div>

  <%# TAB: Mensagens Globais %>
  <div id="tab-content-globais" class="tab-content" style="display: none;">
    <p class="text-sm text-gray-600 mb-4">Mensagens de sistema (Confirmação, Remarcação, Lembrete, etc.). <%= is_manager_above? ? 'Você pode editá-las.' : 'Apenas gerentes podem editar estas mensagens.' %></p>
    <% globais = @messages.select { |m| m.message_type != 'outro' } %>
    <%= render partial: 'messages_table', locals: { messages_to_show: globais, show_type_column: true } %>
  </div>
<% end %>

<%# Button to create a new message %>
<div class="mt-8">
  <%= link_to 'Criar Nova Mensagem Customizada', new_lead_message_path, class: "px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600" %>
</div>

<script>
function showTab(tabName) {
  // Esconder todos os conteúdos
  document.querySelectorAll('.tab-content').forEach(content => {
    content.style.display = 'none';
  });
  
  // Remover classe active de todos os botões
  document.querySelectorAll('.tab-button').forEach(button => {
    button.classList.remove('active');
    button.classList.remove('border-blue-500', 'text-blue-600');
    button.classList.add('border-transparent', 'text-gray-500');
  });
  
  // Mostrar conteúdo selecionado
  document.getElementById('tab-content-' + tabName).style.display = 'block';
  
  // Ativar botão selecionado
  const activeButton = document.getElementById('tab-' + tabName);
  activeButton.classList.add('active');
  activeButton.classList.remove('border-transparent', 'text-gray-500');
  activeButton.classList.add('border-blue-500', 'text-blue-600');
}
</script>

<style>
.tab-button {
  transition: all 0.2s;
}

.tab-button:not(.active) {
  @apply border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300;
}

.tab-button.active {
  @apply border-blue-500 text-blue-600;
}
</style>
