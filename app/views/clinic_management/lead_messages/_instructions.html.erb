<div class="p-4 bg-white rounded shadow-md" data-controller="placeholder-inserter">
    <h5 class="text-lg font-semibold mb-4">Por favor, substitua os seguintes placeholders pelas informa√ß√µes correspondentes:</h5>
    <p class="text-sm text-gray-600 mb-4">üí° <strong>Dica:</strong> Clique nos bot√µes abaixo para inserir automaticamente os placeholders no texto da mensagem.</p>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
        <button type="button" 
                class="placeholder-btn flex items-center justify-between p-3 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg transition-colors duration-200"
                data-placeholder="{NOME_COMPLETO_PACIENTE}"
                data-action="click->placeholder-inserter#insertPlaceholder">
            <div class="text-left">
                <div class="font-semibold text-blue-800">{NOME_COMPLETO_PACIENTE}</div>
                <div class="text-sm text-blue-600">Nome completo do paciente</div>
            </div>
            <i class="material-icons text-blue-500">add_circle_outline</i>
        </button>
        
        <button type="button" 
                class="placeholder-btn flex items-center justify-between p-3 bg-green-50 hover:bg-green-100 border border-green-200 rounded-lg transition-colors duration-200"
                data-placeholder="{PRIMEIRO_NOME_PACIENTE}"
                data-action="click->placeholder-inserter#insertPlaceholder">
            <div class="text-left">
                <div class="font-semibold text-green-800">{PRIMEIRO_NOME_PACIENTE}</div>
                <div class="text-sm text-green-600">Primeiro nome do paciente</div>
            </div>
            <i class="material-icons text-green-500">add_circle_outline</i>
        </button>
        
        <button type="button" 
                class="placeholder-btn flex items-center justify-between p-3 bg-purple-50 hover:bg-purple-100 border border-purple-200 rounded-lg transition-colors duration-200"
                data-placeholder="{DIA_SEMANA_ATENDIMENTO}"
                data-action="click->placeholder-inserter#insertPlaceholder">
            <div class="text-left">
                <div class="font-semibold text-purple-800">{DIA_SEMANA_ATENDIMENTO}</div>
                <div class="text-sm text-purple-600">Dia da semana por extenso</div>
            </div>
            <i class="material-icons text-purple-500">add_circle_outline</i>
        </button>
        
        <button type="button" 
                class="placeholder-btn flex items-center justify-between p-3 bg-indigo-50 hover:bg-indigo-100 border border-indigo-200 rounded-lg transition-colors duration-200"
                data-placeholder="{DATA_DO_ATENDIMENTO}"
                data-action="click->placeholder-inserter#insertPlaceholder">
            <div class="text-left">
                <div class="font-semibold text-indigo-800">{DATA_DO_ATENDIMENTO}</div>
                <div class="text-sm text-indigo-600">Data completa (15/05/23)</div>
            </div>
            <i class="material-icons text-indigo-500">add_circle_outline</i>
        </button>
        
        <button type="button" 
                class="placeholder-btn flex items-center justify-between p-3 bg-pink-50 hover:bg-pink-100 border border-pink-200 rounded-lg transition-colors duration-200"
                data-placeholder="{MES_DO_ATENDIMENTO}"
                data-action="click->placeholder-inserter#insertPlaceholder">
            <div class="text-left">
                <div class="font-semibold text-pink-800">{MES_DO_ATENDIMENTO}</div>
                <div class="text-sm text-pink-600">M√™s por extenso (Maio)</div>
            </div>
            <i class="material-icons text-pink-500">add_circle_outline</i>
        </button>
        
        <button type="button" 
                class="placeholder-btn flex items-center justify-between p-3 bg-yellow-50 hover:bg-yellow-100 border border-yellow-200 rounded-lg transition-colors duration-200"
                data-placeholder="{DIA_ATENDIMENTO_NUMERO}"
                data-action="click->placeholder-inserter#insertPlaceholder">
            <div class="text-left">
                <div class="font-semibold text-yellow-800">{DIA_ATENDIMENTO_NUMERO}</div>
                <div class="text-sm text-yellow-600">Dia do m√™s em n√∫meros (05)</div>
            </div>
            <i class="material-icons text-yellow-500">add_circle_outline</i>
        </button>
        
        <button type="button" 
                class="placeholder-btn flex items-center justify-between p-3 bg-teal-50 hover:bg-teal-100 border border-teal-200 rounded-lg transition-colors duration-200"
                data-placeholder="{HORARIO_DE_INICIO}"
                data-action="click->placeholder-inserter#insertPlaceholder">
            <div class="text-left">
                <div class="font-semibold text-teal-800">{HORARIO_DE_INICIO}</div>
                <div class="text-sm text-teal-600">Hor√°rio de in√≠cio (13:00)</div>
            </div>
            <i class="material-icons text-teal-500">add_circle_outline</i>
        </button>
        
        <button type="button" 
                class="placeholder-btn flex items-center justify-between p-3 bg-orange-50 hover:bg-orange-100 border border-orange-200 rounded-lg transition-colors duration-200"
                data-placeholder="{HORARIO_DE_TERMINO}"
                data-action="click->placeholder-inserter#insertPlaceholder">
            <div class="text-left">
                <div class="font-semibold text-orange-800">{HORARIO_DE_TERMINO}</div>
                <div class="text-sm text-orange-600">Hor√°rio de t√©rmino (16:30)</div>
            </div>
            <i class="material-icons text-orange-500">add_circle_outline</i>
        </button>
    </div>
    <h5 class="text-lg font-semibold mt-4 mb-2">Funcionalidade de M√∫ltiplas Mensagens Sorteadas:</h5>
    <p>Para incluir m√∫ltiplas op√ß√µes de frases na mensagem, que ser√£o escolhidas aleatoriamente, use colchetes `[]` com op√ß√µes separadas pelo s√≠mbolo `|`. Por exemplo, `[Op√ß√£o 1|Op√ß√£o 2|Op√ß√£o 3]` escolher√° aleatoriamente uma das op√ß√µes.</p>

    <!-- Preview Section -->
    <% sample_appointment = get_sample_appointment_for_preview %>
    <div class="mt-6 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4" data-controller="message-preview">
        <div class="flex items-center justify-between mb-3">
            <h5 class="text-lg font-semibold text-blue-800 flex items-center">
                <i class="material-icons mr-2">preview</i>
                üìã Exemplo de Como a Mensagem Ficaria
            </h5>
            <button type="button" 
                    class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center transition-colors duration-200"
                    data-action="click->message-preview#refreshPreview"
                    data-message-preview-target="refreshButton">
                <i class="material-icons mr-2 text-sm">refresh</i>
                Atualizar
            </button>
        </div>
        
        <div class="bg-white rounded-lg p-4 border border-blue-100" data-message-preview-target="previewContainer">
            <div class="mb-3">
                <h6 class="font-semibold text-gray-700 mb-2">üìù Texto Original (com placeholders):</h6>
                <div class="bg-gray-50 p-3 rounded border text-sm font-mono" data-message-preview-target="originalText">
                    <% if action_name == 'edit' && defined?(@message) && @message.text.present? %>
                        <%= @message.text.gsub("\n", "<br>").html_safe %>
                    <% elsif action_name == 'new' %>
                        <span class="text-gray-400 italic">Digite sua mensagem no campo acima para ver o preview aqui...</span>
                    <% else %>
                        üëã Ol√°, {PRIMEIRO_NOME_PACIENTE}!<br><br>
                        Aqui √© a Jussara! [Est√°vamos te esperando|te aguardamos] para o seu exame de vista üëÅ no {DIA_SEMANA_ATENDIMENTO}, dia {DIA_ATENDIMENTO_NUMERO} de {MES_DO_ATENDIMENTO} ({DATA_DO_ATENDIMENTO}), das {HORARIO_DE_INICIO} √†s {HORARIO_DE_TERMINO}, mas voc√™ n√£o pode vir.<br><br>
                        Se quiser, me avise üì± que agendamos um novo hor√°rio! Cuidar da sua vis√£o √© muito importante! üëÅüíô
                    <% end %>
                </div>
            </div>
            
            <div>
                <h6 class="font-semibold text-gray-700 mb-2">‚ú® Como Ficaria Enviada (com dados reais):</h6>
                <div class="bg-green-50 p-3 rounded border" style="font-size: 16px;" data-message-preview-target="previewText">
                    <% if action_name == 'edit' && defined?(@message) && @message.text.present? %>
                        <% if @message.text.match(/\[([^\]]+\|[^\]]+)\]/) %>
                            <!-- Message has random options, show multiple variations -->
                            <div class="space-y-4">
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <h6 class="font-semibold text-blue-800 mb-2">üì± Varia√ß√£o 1:</h6>
                                    <div class="text-gray-800" style="font-size: 16px;">
                                        <%= generate_random_variation(@message.text, sample_appointment, 1).gsub("\n", "<br>").html_safe %>
                                    </div>
                                </div>
                                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                    <h6 class="font-semibold text-green-800 mb-2">üì± Varia√ß√£o 2:</h6>
                                    <div class="text-gray-800" style="font-size: 16px;">
                                        <%= generate_random_variation(@message.text, sample_appointment, 2).gsub("\n", "<br>").html_safe %>
                                    </div>
                                </div>
                                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-2">
                                    <p class="text-sm text-yellow-800">
                                        <i class="material-icons text-sm mr-1">info</i>
                                        O sistema escolher√° aleatoriamente uma das varia√ß√µes ao enviar a mensagem.
                                    </p>
                                </div>
                            </div>
                        <% else %>
                            <!-- Regular message without random options -->
                            <%= format_placeholder_preview(@message.text, sample_appointment).gsub("\n", "<br>").html_safe %>
                        <% end %>
                    <% elsif action_name == 'new' %>
                        <span class="text-gray-400 italic">Preview aparecer√° aqui quando voc√™ digitar uma mensagem...</span>
                    <% else %>
                        <%= format_placeholder_preview("üëã Ol√°, {PRIMEIRO_NOME_PACIENTE}!

Aqui √© a Jussara! [Est√°vamos te esperando|te aguardamos] para o seu exame de vista üëÅ no {DIA_SEMANA_ATENDIMENTO}, dia {DIA_ATENDIMENTO_NUMERO} de {MES_DO_ATENDIMENTO} ({DATA_DO_ATENDIMENTO}), das {HORARIO_DE_INICIO} √†s {HORARIO_DE_TERMINO}, mas voc√™ n√£o pode vir.

Se quiser, me avise üì± que agendamos um novo hor√°rio! Cuidar da sua vis√£o √© muito importante! üëÅüíô", sample_appointment).html_safe %>
                    <% end %>
                </div>
            </div>
            
            <div class="mt-3 text-xs text-gray-500 flex items-center" data-message-preview-target="patientInfo">
                <i class="material-icons text-sm mr-1">info</i>
                <% if sample_appointment.respond_to?(:invitation) && sample_appointment.invitation.respond_to?(:lead) %>
                    Exemplo baseado em agendamento real do paciente: <strong><%= sample_appointment.invitation.lead&.name || sample_appointment.invitation.patient_name %></strong>
                <% else %>
                    Exemplo com dados fict√≠cios (nenhum agendamento encontrado no banco)
                <% end %>
            </div>
        </div>
    </div>
    
</div>
