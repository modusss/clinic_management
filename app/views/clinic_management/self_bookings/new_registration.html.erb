<%# ============================================================================
    Self-Booking: New Registration Screen
    
    This screen is shown to users who received a booking link via WhatsApp
    from another patient. The phone number is already fixed (verified by
    receiving the WhatsApp message).
    
    The user only needs to enter their name to create their profile and
    continue with the booking.
    
    REFERRAL ATTRIBUTION: Always "Local" (organic/shared by patient)
    ============================================================================ %>

<!-- Step indicator -->
<div class="step-indicator">
  <div class="step-dot active"></div>
  <div class="step-dot"></div>
  <div class="step-dot"></div>
  <div class="step-dot"></div>
</div>

<!-- Main card -->
<div class="booking-card">
  <div class="text-center mb-6">
    <div class="inline-flex items-center justify-center w-16 h-16 bg-emerald-100 rounded-full mb-4">
      <i class="fas fa-user-plus text-emerald-600 text-2xl"></i>
    </div>
  </div>
  
  <h2 class="text-xl font-bold text-gray-900 text-center mb-2">
    Bem-vindo!
  </h2>
  
  <p class="text-gray-600 text-center mb-6">
    Complete seu cadastro para agendar sua consulta
  </p>
  
  <%= form_with url: self_booking_create_registration_path(@lead.self_booking_token), 
                method: :post, 
                local: true,
                class: "space-y-4" do %>
    
    <%# Phone field - FIXED, cannot be changed %>
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">
        <i class="fas fa-phone text-gray-400 mr-1"></i>
        Seu telefone
      </label>
      <div class="phone-fixed-display">
        <i class="fab fa-whatsapp text-green-500 mr-2"></i>
        <span><%= @formatted_phone %></span>
        <i class="fas fa-check-circle text-emerald-500 ml-auto"></i>
      </div>
      <input type="hidden" name="patient_phone" value="<%= @new_phone %>">
      <p class="mt-1 text-xs text-emerald-600">
        <i class="fas fa-shield-alt mr-1"></i>
        Número verificado via WhatsApp
      </p>
    </div>
    
    <%# Patient name field %>
    <div>
      <label for="patient_name" class="block text-sm font-medium text-gray-700 mb-2">
        <i class="fas fa-user text-gray-400 mr-1"></i>
        Seu nome completo
      </label>
      <input type="text" 
             name="patient_name" 
             id="patient_name"
             required
             autofocus
             placeholder="Ex: Maria Silva"
             class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-lg
                    focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 
                    focus:outline-none transition-all"
             value="<%= @suggested_name %>">
    </div>
    
    <% if @existing_lead %>
      <%# Show info that this phone already has a profile %>
      <div class="existing-profile-notice">
        <i class="fas fa-info-circle text-blue-500 mr-2"></i>
        <span>
          Este telefone já possui um cadastro como <strong><%= @existing_lead.name %></strong>. 
          Confirme seu nome para continuar.
        </span>
      </div>
    <% end %>
    
    <button type="submit" class="btn-primary">
      <i class="fas fa-arrow-right mr-2"></i>
      Continuar para agendamento
    </button>
  <% end %>
</div>

<!-- Help text -->
<p class="text-center text-gray-500 text-sm mt-4">
  <i class="fas fa-lock mr-1"></i>
  Seus dados estão seguros conosco
</p>
