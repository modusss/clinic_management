<%# ============================================================================
    Self-Booking: Share Invite Screen
    
    This screen is shown to people who received a shared booking link from
    a friend/patient. They need to register their name and phone to continue.
    
    REFERRAL ATTRIBUTION: Always "Local" (patient shared, not referral)
    ============================================================================ %>

<!-- Step indicator -->
<div class="step-indicator">
  <div class="step-dot active"></div>
  <div class="step-dot"></div>
  <div class="step-dot"></div>
  <div class="step-dot"></div>
</div>

<!-- Main card -->
<div class="booking-card">
  <div class="text-center mb-6">
    <div class="inline-flex items-center justify-center w-16 h-16 bg-emerald-100 rounded-full mb-4">
      <i class="fas fa-user-plus text-emerald-600 text-2xl"></i>
    </div>
  </div>
  
  <h2 class="text-xl font-bold text-gray-900 text-center mb-2">
    Agende sua consulta!
  </h2>
  
  <p class="text-gray-600 text-center mb-6">
    <span class="text-emerald-600 font-medium"><%= @sharer_name %></span> compartilhou este link com você.
    <br>Preencha seus dados para continuar.
  </p>
  
  <%= form_with url: self_booking_create_shared_booking_path(@lead.self_booking_token), 
                method: :post, 
                local: true,
                class: "space-y-4" do %>
    
    <%# Patient name field %>
    <div>
      <label for="patient_name" class="block text-sm font-medium text-gray-700 mb-2">
        <i class="fas fa-user text-gray-400 mr-1"></i>
        Seu nome completo
      </label>
      <input type="text" 
             name="patient_name" 
             id="patient_name"
             required
             autofocus
             placeholder="Ex: Maria Silva"
             class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-lg
                    focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 
                    focus:outline-none transition-all"
             value="">
    </div>
    
    <%# Phone field %>
    <div>
      <label for="patient_phone" class="block text-sm font-medium text-gray-700 mb-2">
        <i class="fas fa-phone text-gray-400 mr-1"></i>
        Seu telefone (WhatsApp)
      </label>
      <input type="tel" 
             name="patient_phone" 
             id="patient_phone"
             required
             placeholder="(99) 99999-9999"
             inputmode="numeric"
             class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-lg
                    focus:border-emerald-500 focus:ring-2 focus:ring-emerald-200 
                    focus:outline-none transition-all"
             value="">
    </div>
    
    <button type="submit" class="btn-primary">
      <i class="fas fa-arrow-right mr-2"></i>
      Continuar para agendamento
    </button>
  <% end %>
</div>

<!-- Help text -->
<p class="text-center text-gray-500 text-sm mt-4">
  <i class="fas fa-lock mr-1"></i>
  Seus dados estão seguros conosco
</p>

<%# Phone mask script %>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const phoneInput = document.getElementById('patient_phone');
    if (phoneInput) {
      phoneInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length > 11) value = value.slice(0, 11);
        
        if (value.length > 0) {
          if (value.length <= 2) {
            value = '(' + value;
          } else if (value.length <= 7) {
            value = '(' + value.slice(0, 2) + ') ' + value.slice(2);
          } else {
            value = '(' + value.slice(0, 2) + ') ' + value.slice(2, 7) + '-' + value.slice(7);
          }
        }
        e.target.value = value;
      });
    }
  });
</script>
