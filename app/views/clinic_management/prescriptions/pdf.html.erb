<!DOCTYPE html>
<html>
<head>
  <title>Receita de Lentes</title>
  <style>
    body {
      font-family: Arial, sans-serif; 
      margin: 0; 
      padding: 0; 
      line-height: 1.6;
    }
    h1 {
      text-align: center; 
      margin-top: 40px; 
      margin-bottom: 20px;
    }
    .description, .note, .contact-info {
      margin: 0 20px 20px 20px;
    }
    table {
      width: 90%; 
      margin: 0 auto 20px auto; 
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ddd; 
      padding: 10px; 
      text-align: center;
    }
    th {
      background-color: #f2f2f2; 
      font-weight: bold;
    }
    .logo {
      display: block; 
      margin: 20px auto; 
      max-width: 200px; 
      max-height: 120px;
      width: auto;
      height: auto;
      object-fit: contain;
    }
    .qr_code {
      text-align: center; 
      margin: 0 auto;
    }
    .footer-text {
      margin-bottom: 5px;
    }
    .rotate-text {
      transform: rotate(-90deg); 
      margin: 0;
    }
  </style>
</head>

<body>
      <br>

  <div class="header">
    <h1>Dados do Teste de Refração de Acuidade Visual</h1>
  </div>

  <div class="description mt-4">
    <p>Prezado(a) <%= @prescription.appointment.invitation.patient_name.split.first.upcase %>,</p>
    
    <p>
      Seguem abaixo os resultados do seu teste de vista. Esses valores indicam 
      as correções necessárias para a confecção das suas lentes de óculos.
    </p>
  </div>

  <table>
    <thead>
      <tr>
        <th></th>
        <th>ESFÉRICO</th>
        <th>CILINDRO</th>
        <th>EIXO</th>
        <th>ADIÇÃO</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Direito (OD)</td>
        <% sr = @prescription.sphere_right.to_f %>
        <td><%= sr == 0 ? "--" : (sr > 0 ? "+" : "") + number_with_precision(sr, precision: 2, separator: ',') %></td>
        <td><%= @prescription.cylinder_right.to_f == 0 ? "--" : number_with_precision(@prescription.cylinder_right, precision: 2, separator: ',') || "--" %></td>
        <td><%= @prescription.axis_right.to_i == 0 ? "--" : (@prescription.axis_right || "--") %></td>
        <td><%= @prescription.add_right.to_f == 0 ? "--" : number_with_precision(@prescription.add_right, precision: 2, separator: ',') || "--" %></td>
      </tr>
      <tr>
        <td>Esquerdo (OE)</td>
        <% sl = @prescription.sphere_left.to_f %>
        <td><%= sl == 0 ? "--" : (sl > 0 ? "+" : "") + number_with_precision(sl, precision: 2, separator: ',') %></td>
        <td><%= @prescription.cylinder_left.to_f == 0 ? "--" : number_with_precision(@prescription.cylinder_left, precision: 2, separator: ',') || "--" %></td>
        <td><%= @prescription.axis_left.to_i == 0 ? "--" : (@prescription.axis_left || "--") %></td>
        <td><%= @prescription.add_left.to_f == 0 ? "--" : number_with_precision(@prescription.add_left, precision: 2, separator: ',') || "--" %></td>
      </tr>
    </tbody>
  </table>

  <div class="note">
    <p class="footer-text">
      Ao optar por confeccionar suas lentes conosco, você conta com a nossa 
      garantia de resultados e assistência.
      caso não se adapte às novas lentes, nós as refaremos quantas vezes forem necessárias, 
      <strong>sem nenhum custo adicional</strong>.Mas não nos responsabilizamos caso não se adapte e as lentes sejam produzidas em outros 
      estabelecimentos. Em caso de dúvidas, nossa equipe está à disposição para ajudá-lo.
    </p>
    <br>
    <div class="date-info">
      <strong>Data:</strong> <%= @prescription.appointment.service.date.strftime("%d/%m/%Y") %>
    </div>
  </div>
    <br>
    <br>
  <div class="contact-info">
    <!-- Logo e informações da conta -->
    <div style="text-align: center;">
      <% if current_user&.accounts&.first&.logo&.attached? %>
        <%= image_tag active_storage_image_base64(current_user.accounts.first.logo), class: "logo" %>
      <% end %>
    </div>

    <div style="text-align: center;">
      <% if @company_contact.present? %>
        <div>
          <strong>Tel:</strong> <%= @company_contact.phone1 %><%= " | #{@company_contact.phone2}" if @company_contact.phone2.present? %>
        </div>
        <div>
          <%= @company_contact.street %><%= ", #{@company_contact.neighborhood}" if @company_contact.neighborhood.present? %>
        </div>
        <div>
          <%= @company_contact.city %>/<%= @company_contact.state %>
        </div>
      <% else %>
        <div>
          <strong>Tel:</strong> (77) 9 9836-7332 | (77) 9 8804-3621
        </div>
        <div>
          Rua Joaquim Nabuco, 99B, Centro
        </div>
        <div>
          Vitória da Conquista/BA
        </div>
      <% end %>
    </div>
  </div>
</body>
</html>
