<%# Toggle for table/cards view. Stores preference in a cookie. %>
<div class="view-toggle-container right-align mb-4">
  <div class="btn-group">
    <a href="<%= clinic_management.index_before_path(view_type: 'table') %>"
       onclick="document.cookie = 'preferred_prescriptions_before_view=table; path=/; max-age=31536000';"
       class="btn btn-small <%= @view_type != 'cards' ? 'active' : '' %>">
      <i class="fa fa-list-ul" style="margin-right: 4px;"></i>Tabela
    </a>
    <a href="<%= clinic_management.index_before_path(view_type: 'cards') %>"
       onclick="document.cookie = 'preferred_prescriptions_before_view=cards; path=/; max-age=31536000';"
       class="btn btn-small <%= @view_type == 'cards' ? 'active' : '' %>">
      <i class="fa fa-th-large" style="margin-right: 4px;"></i>Cartão
    </a>
  </div>
</div>

<% if @services.present? %>
  <% @rows.each_with_index do |rows, index| %>
    <% service = @services[index] %>
    <%# Service header %>
    <h1 class="text-3xl font-bold text-gray-900 mb-2">
      Atendimento anterior: <%= show_week_day service.weekday %>
    </h1>
    <h2 class="text-2xl text-gray-700 mb-1"><%= service.service_type&.name %></h2>
    <h2 class="text-2xl text-gray-700 mb-1"><%= service.date.strftime("%d/%m/%Y") %></h2>
    <h3 class="text-xl text-gray-700 mb-3">
      <%= service.start_time.strftime('%H:%M') %>h às <%= service.end_time.strftime('%H:%M') %>h
    </h3>
    <%= link_to "Encaixar novo paciente", new_patient_fitted_invitations_path(service), class: "inline-block bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-6" %>
    <%= link_to "Página do atendimento", service_path(service), class: "text-blue-500 hover:text-blue-700" %>
    <br>
    <br>
    <% if @view_type == 'cards' %>
      <%= render partial: "today_cards", locals: { rows: [rows], services: [service] } %>
    <% else %>
      <div data-controller="table">
        <%= data_table(rows, 3) %>
      </div>
    <% end %>
    <hr class="my-6">
  <% end %>
<% else %>
  <p>Nenhum atendimento anterior encontrado.</p>
<% end %> 